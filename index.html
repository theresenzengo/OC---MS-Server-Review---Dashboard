<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Microsoft Licensing Tracker - Oetker Collection</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-page: linear-gradient(160deg, #1a1a2e 0%, #1a2744 40%, #16213e 70%, #1a1a2e 100%);
      --text-primary: #1a1a2e;
      --text-secondary: #5a5a6e;
      --text-muted: #8a8a9a;
      --text-light: #ffffff;
      --accent-orange: #E87A2A;
      --accent-orange-light: #F5923D;
      --accent-orange-bg: rgba(232, 122, 42, 0.1);
      --accent-green: #10b981;
      --accent-green-bg: rgba(16, 185, 129, 0.1);
      --accent-yellow: #f59e0b;
      --accent-yellow-bg: rgba(245, 158, 11, 0.1);
      --accent-red: #ef4444;
      --accent-red-bg: rgba(239, 68, 68, 0.1);
      --accent-blue: #3b82f6;
      --accent-blue-bg: rgba(59, 130, 246, 0.1);
      --accent-purple: #8b5cf6;
      --accent-purple-bg: rgba(139, 92, 246, 0.1);
      --accent-cyan: #06b6d4;
      --accent-cyan-bg: rgba(6, 182, 212, 0.1);
      --accent-rose: #f43f5e;
      --accent-rose-bg: rgba(244, 63, 94, 0.1);
      --border-color: #c8c8d0;
      --shadow-sm: 0 2px 8px rgba(0,0,0,0.15);
      --shadow-md: 0 4px 20px rgba(0,0,0,0.25);
      --gradient-header: linear-gradient(135deg, #1a1a2e 0%, #1e3a5f 40%, #3b82f6 100%);
      --gradient-card: linear-gradient(180deg, #e5e5eb 0%, #c8c8d0 100%);
      --gradient-orange: linear-gradient(135deg, #E87A2A 0%, #F5923D 100%);
      --card-dark: linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(15, 23, 42, 0.95) 100%);
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'DM Sans', sans-serif; background: var(--bg-page); color: var(--text-light); min-height: 100vh; }
    .app-container { max-width: 1600px; margin: 0 auto; padding: 2rem; padding-top: 1rem; }
    
    /* Header - Sticky */
    .header-wrapper {
      position: sticky;
      top: 1rem;
      z-index: 50;
      margin-bottom: 2rem;
    }
    .header { 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      padding: 1rem 2rem; 
      background: var(--gradient-header); 
      border-radius: 16px;
      box-shadow: var(--shadow-md); 
    }
    .logo-section { display: flex; align-items: center; gap: 1.5rem; }
    .logo-img { height: 40px; width: auto; }
    .logo-text h1 { font-size: 1.4rem; font-weight: 700; color: var(--text-light); }
    .logo-text span { font-size: 0.85rem; color: rgba(255,255,255,0.7); }
    .header-right { display: flex; align-items: center; gap: 1.5rem; }
    .last-update { font-family: 'Space Mono', monospace; font-size: 0.75rem; color: rgba(255,255,255,0.6); }
    .loading-indicator { display: flex; align-items: center; gap: 0.5rem; font-size: 0.8rem; color: var(--accent-orange); margin-top: 0.25rem; }
    .loading-dot { width: 8px; height: 8px; background: var(--accent-orange); border-radius: 50%; animation: pulse 1.5s infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
    
    /* Subsidiary Filter */
    .subsidiary-filter {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      background: rgba(255,255,255,0.1);
      padding: 0.5rem 1rem;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.2);
    }
    .subsidiary-filter label {
      font-size: 0.75rem;
      color: rgba(255,255,255,0.7);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .subsidiary-filter select {
      background: transparent;
      border: none;
      color: white;
      font-family: 'DM Sans', sans-serif;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      padding-right: 1rem;
    }
    .subsidiary-filter select option { background: #1a1a2e; color: white; }
    .subsidiary-filter select:focus { outline: none; }
    
    /* KPI Grid - 5 cards */
    .kpi-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
    @media (max-width: 1200px) { .kpi-grid { grid-template-columns: repeat(3, 1fr); } }
    @media (max-width: 768px) { .kpi-grid { grid-template-columns: repeat(2, 1fr); } }
    .kpi-card { 
      background: var(--gradient-card); 
      border-radius: 12px; 
      padding: 1.25rem; 
      position: relative; 
      box-shadow: var(--shadow-sm); 
      overflow: hidden; 
    }
    .kpi-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--gradient-orange); }
    .kpi-card.green::before { background: var(--accent-green); }
    .kpi-card.yellow::before { background: var(--accent-yellow); }
    .kpi-card.red::before { background: var(--accent-red); }
    .kpi-label { font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.5rem; }
    .kpi-value { font-size: 2rem; font-weight: 700; font-family: 'Space Mono', monospace; color: var(--text-primary); }
    .kpi-subtitle { font-size: 0.7rem; color: var(--text-muted); margin-top: 0.25rem; }
    
    /* Main License Section */
    .license-section {
      margin-bottom: 2rem;
    }
    @media (max-width: 1100px) { 
      .license-section { 
        margin-bottom: 1.5rem;
      }
    }
    
    /* Compliance Bars */
    .compliance-panel {
      display: flex;
      flex-direction: column;
    }
    
    /* Section Title */
    .section-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1.25rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid rgba(255,255,255,0.15);
    }
    .section-title {
      font-size: 0.85rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: rgba(255,255,255,0.7);
    }
    
    /* EOS Warning Badge */
    .eos-badge {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: linear-gradient(135deg, rgba(251, 191, 36, 0.2) 0%, rgba(245, 158, 11, 0.15) 100%);
      border: 1px solid rgba(251, 191, 36, 0.4);
      border-radius: 10px;
      padding: 0.6rem 1rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .eos-badge:hover {
      background: linear-gradient(135deg, rgba(251, 191, 36, 0.3) 0%, rgba(245, 158, 11, 0.25) 100%);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(251, 191, 36, 0.2);
    }
    .eos-badge-icon {
      font-size: 1.1rem;
    }
    .eos-badge-text {
      font-size: 0.8rem;
      font-weight: 600;
      color: #fbbf24;
    }
    .eos-badge-count {
      font-family: 'Space Mono', monospace;
      font-size: 0.85rem;
      font-weight: 700;
      color: #fcd34d;
      background: rgba(0,0,0,0.2);
      padding: 0.2rem 0.5rem;
      border-radius: 6px;
    }
    .compliance-bars {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      flex: 1;
    }
    .compliance-bar-item {
      background: var(--card-dark);
      border-radius: 12px;
      padding: 1rem 1.25rem;
      border: 1px solid rgba(255,255,255,0.08);
    }
    .compliance-bar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    .compliance-bar-label {
      font-size: 0.8rem;
      font-weight: 600;
      color: rgba(255,255,255,0.9);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .compliance-bar-metric {
      font-size: 0.65rem;
      color: rgba(255,255,255,0.5);
      background: rgba(255,255,255,0.1);
      padding: 0.15rem 0.4rem;
      border-radius: 4px;
    }
    .compliance-bar-values {
      font-size: 0.8rem;
      font-family: 'Space Mono', monospace;
      color: rgba(255,255,255,0.7);
    }
    .compliance-bar-values .required { color: var(--accent-orange); font-weight: 600; }
    .compliance-bar-values .entitled { color: rgba(255,255,255,0.5); }
    .compliance-bar-container {
      height: 24px;
      background: rgba(255,255,255,0.1);
      border-radius: 6px;
      overflow: hidden;
      position: relative;
    }
    .compliance-bar-fill {
      height: 100%;
      border-radius: 6px;
      transition: width 0.5s ease;
      position: relative;
    }
    .compliance-bar-fill.compliant {
      background: linear-gradient(90deg, #10b981, #34d399);
    }
    .compliance-bar-fill.warning {
      background: linear-gradient(90deg, #f59e0b, #fbbf24);
    }
    .compliance-bar-fill.over {
      background: repeating-linear-gradient(
        90deg,
        #ef4444 0%,
        #f87171 50%,
        #ef4444 100%
      );
      animation: pulse-bar 2s ease-in-out infinite;
    }
    @keyframes pulse-bar {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }
    .compliance-bar-marker {
      position: absolute;
      top: -4px;
      bottom: -4px;
      width: 3px;
      background: white;
      border-radius: 2px;
      box-shadow: 0 0 4px rgba(0,0,0,0.5);
    }
    .compliance-bar-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 0.5rem;
    }
    .compliance-percentage {
      font-size: 0.85rem;
      font-weight: 700;
      font-family: 'Space Mono', monospace;
    }
    .compliance-percentage.compliant { color: #10b981; }
    .compliance-percentage.warning { color: #f59e0b; }
    .compliance-percentage.over { color: #ef4444; }
    .compliance-gap {
      font-size: 0.75rem;
      font-family: 'Space Mono', monospace;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
    }
    .compliance-gap.surplus { background: var(--accent-green-bg); color: #10b981; }
    .compliance-gap.deficit { background: var(--accent-red-bg); color: #ef4444; }
    
    /* No Data State */
    .no-data-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 3rem;
      color: rgba(255,255,255,0.4);
      text-align: center;
    }
    .no-data-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }
    .no-data-text {
      font-size: 1rem;
      margin-bottom: 0.5rem;
    }
    .no-data-subtext {
      font-size: 0.8rem;
      color: rgba(255,255,255,0.3);
    }
    
    /* EOS Modal */
    .eos-modal {
      background: linear-gradient(135deg, #2d2a1a 0%, #1a1a2e 100%);
      border-radius: 16px;
      padding: 1.5rem;
      max-width: 450px;
      width: 100%;
      border: 1px solid rgba(251, 191, 36, 0.3);
    }
    .eos-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.25rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid rgba(251, 191, 36, 0.2);
    }
    .eos-modal-title {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 1rem;
      font-weight: 600;
      color: #fbbf24;
    }
    .eos-modal-close {
      background: rgba(255,255,255,0.1);
      border: none;
      color: rgba(255,255,255,0.6);
      width: 32px;
      height: 32px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }
    .eos-modal-close:hover {
      background: rgba(255,255,255,0.2);
      color: white;
    }
    .eos-modal-value {
      font-size: 2.5rem;
      font-weight: 700;
      font-family: 'Space Mono', monospace;
      color: #fcd34d;
      margin-bottom: 0.25rem;
    }
    .eos-modal-label {
      font-size: 0.9rem;
      color: rgba(255,255,255,0.6);
      margin-bottom: 1.25rem;
    }
    .eos-modal-breakdown {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin-bottom: 1.25rem;
    }
    .eos-modal-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: rgba(255,255,255,0.05);
      padding: 0.75rem 1rem;
      border-radius: 8px;
    }
    .eos-modal-item-left {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    .eos-modal-dot {
      width: 12px;
      height: 12px;
      border-radius: 3px;
    }
    .eos-modal-dot.critical { background: #ef4444; }
    .eos-modal-dot.high { background: #f97316; }
    .eos-modal-dot.medium { background: #eab308; }
    .eos-modal-item-label {
      font-size: 0.9rem;
      color: rgba(255,255,255,0.8);
    }
    .eos-modal-item-count {
      font-family: 'Space Mono', monospace;
      font-size: 1rem;
      font-weight: 700;
      color: white;
    }
    .eos-modal-affected {
      font-size: 0.8rem;
      color: rgba(255,255,255,0.5);
      font-style: italic;
      padding-top: 0.75rem;
      border-top: 1px solid rgba(255,255,255,0.1);
    }
    
    /* Tabs & Search */
    .tabs-container { 
      background: var(--gradient-card); 
      border-radius: 12px; 
      padding: 0.5rem; 
      margin-bottom: 1.5rem; 
      box-shadow: var(--shadow-sm); 
      display: inline-flex; 
      gap: 0.25rem; 
    }
    .tab { background: transparent; border: none; color: var(--text-secondary); padding: 0.6rem 1.2rem; border-radius: 8px; cursor: pointer; font-family: 'DM Sans', sans-serif; font-size: 0.9rem; font-weight: 500; transition: all 0.2s ease; }
    .tab:hover { color: var(--text-primary); background: rgba(255,255,255,0.5); }
    .tab.active { color: white; background: var(--accent-orange); }
    .filter-bar { display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap; align-items: center; }
    .search-input { 
      background: var(--gradient-card); 
      border: none; 
      color: var(--text-primary); 
      padding: 0.75rem 1rem; 
      border-radius: 10px; 
      font-family: 'DM Sans', sans-serif; 
      font-size: 0.9rem; 
      flex: 1; 
      min-width: 200px; 
      box-shadow: var(--shadow-sm); 
    }
    .search-input::placeholder { color: var(--text-muted); }
    .search-input:focus { outline: none; box-shadow: 0 0 0 3px var(--accent-orange-bg), var(--shadow-sm); }
    
    /* BU Cards */
    .bu-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(380px, 1fr)); gap: 1.25rem; }
    .bu-card { 
      background: var(--gradient-card); 
      border-radius: 14px; 
      padding: 1.5rem; 
      cursor: pointer; 
      transition: all 0.2s ease; 
      position: relative; 
      box-shadow: var(--shadow-sm); 
    }
    .bu-card:hover { box-shadow: var(--shadow-md); transform: translateY(-3px); }
    .bu-card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem; }
    .bu-unit-badge { font-family: 'Space Mono', monospace; font-size: 0.7rem; background: var(--accent-orange-bg); color: var(--accent-orange); padding: 0.25rem 0.5rem; border-radius: 6px; font-weight: 600; }
    .bu-name { font-size: 1.15rem; font-weight: 600; margin: 0.5rem 0 0.25rem 0; color: var(--text-primary); }
    .bu-country { font-size: 0.85rem; color: var(--text-secondary); }
    .bu-subsidiary { font-size: 0.7rem; color: var(--text-muted); margin-top: 0.25rem; }
    .subsidiary-tag { display: inline-block; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.65rem; font-weight: 600; text-transform: uppercase; }
    .subsidiary-tag.martin-braun { background: var(--accent-blue-bg); color: var(--accent-blue); }
    .subsidiary-tag.budenheim { background: var(--accent-cyan-bg); color: var(--accent-cyan); }
    .subsidiary-tag.henkell-freixenet { background: var(--accent-purple-bg); color: var(--accent-purple); }
    .subsidiary-tag.oe-hotels { background: var(--accent-rose-bg); color: var(--accent-rose); }
    .bu-infra-summary { font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem; font-style: italic; background: rgba(255,255,255,0.4); padding: 0.5rem 0.75rem; border-radius: 6px; }
    .status-badge { display: inline-flex; align-items: center; gap: 0.35rem; padding: 0.35rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 600; text-transform: uppercase; }
    .status-badge.complete { background: var(--accent-green-bg); color: var(--accent-green); }
    .status-badge.received { background: var(--accent-orange-bg); color: var(--accent-orange); }
    .status-badge.incomplete { background: var(--accent-yellow-bg); color: var(--accent-yellow); }
    .status-badge.pending { background: var(--accent-yellow-bg); color: var(--accent-yellow); }
    .status-badge.not-sent { background: var(--accent-red-bg); color: var(--accent-red); }
    .status-badge.out-of-scope { background: rgba(0,0,0,0.1); color: var(--text-muted); }
    .status-badge.no-data { background: rgba(0,0,0,0.1); color: var(--text-muted); }
    .status-dot { width: 6px; height: 6px; border-radius: 50%; background: currentColor; }
    .progress-section { margin: 1rem 0; }
    .progress-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; }
    .progress-label { font-size: 0.8rem; color: var(--text-secondary); }
    .progress-value { font-family: 'Space Mono', monospace; font-size: 0.85rem; font-weight: 700; color: var(--text-primary); }
    .progress-bar { height: 8px; background: rgba(0,0,0,0.1); border-radius: 4px; overflow: hidden; }
    .progress-fill { height: 100%; background: var(--gradient-orange); border-radius: 4px; }
    .license-summary { display: flex; gap: 0.5rem; margin: 1rem 0; flex-wrap: wrap; }
    .license-tag { display: inline-flex; align-items: center; gap: 0.3rem; padding: 0.3rem 0.6rem; border-radius: 6px; font-size: 0.75rem; font-weight: 600; font-family: 'Space Mono', monospace; }
    .license-tag.ws { background: var(--accent-blue-bg); color: var(--accent-blue); }
    .license-tag.sql { background: var(--accent-purple-bg); color: var(--accent-purple); }
    .license-tag.rds { background: var(--accent-green-bg); color: var(--accent-green); }
    .checklist-mini { display: flex; gap: 0.4rem; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color); }
    .check-dot { width: 10px; height: 10px; border-radius: 50%; background: rgba(0,0,0,0.15); }
    .check-dot.done { background: var(--accent-green); }
    .priority-badge { position: absolute; top: 1rem; right: 1rem; font-size: 0.65rem; font-weight: 700; text-transform: uppercase; padding: 0.3rem 0.6rem; border-radius: 6px; }
    .priority-badge.critical { background: var(--accent-rose-bg); color: var(--accent-rose); }
    .priority-badge.high { background: var(--accent-red-bg); color: var(--accent-red); }
    .priority-badge.medium { background: var(--accent-yellow-bg); color: var(--accent-yellow); }
    .priority-badge.low { background: var(--accent-green-bg); color: var(--accent-green); }
    
    /* Modal */
    .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(4px); display: flex; align-items: center; justify-content: center; z-index: 100; padding: 1rem; }
    .modal-content { background: linear-gradient(180deg, #e5e5eb 0%, #d0d0d8 100%); border-radius: 20px; width: 100%; max-width: 750px; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.4); }
    .modal-header { padding: 1.75rem; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: flex-start; background: linear-gradient(180deg, #d8d8e0 0%, #c8c8d0 100%); border-radius: 20px 20px 0 0; }
    .modal-close { background: rgba(255,255,255,0.8); border: 1px solid var(--border-color); color: var(--text-primary); width: 40px; height: 40px; border-radius: 10px; cursor: pointer; font-size: 1.25rem; display: flex; align-items: center; justify-content: center; }
    .modal-close:hover { background: var(--accent-red); border-color: var(--accent-red); color: white; }
    .modal-body { padding: 1.75rem; }
    .detail-section { margin-bottom: 1.75rem; }
    .detail-section h3 { font-size: 0.8rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid var(--border-color); }
    .info-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }
    .info-item { background: rgba(255,255,255,0.5); padding: 1rem; border-radius: 10px; }
    .info-item.full-width { grid-column: span 2; }
    .info-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; margin-bottom: 0.3rem; }
    .info-value { font-size: 0.95rem; font-weight: 600; color: var(--text-primary); }
    .info-value.infra { font-weight: 400; font-style: italic; color: var(--text-secondary); }
    .license-table { width: 100%; border-collapse: collapse; margin-top: 0.5rem; background: rgba(255,255,255,0.4); border-radius: 10px; overflow: hidden; }
    .license-table th, .license-table td { padding: 0.75rem 1rem; text-align: left; border-bottom: 1px solid var(--border-color); }
    .license-table th { background: rgba(255,255,255,0.5); font-size: 0.75rem; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; }
    .license-table td { font-size: 0.9rem; color: var(--text-primary); }
    .license-table tr:last-child td { border-bottom: none; }
    .license-table .product-cell { display: flex; align-items: center; gap: 0.5rem; }
    .license-table .product-icon { width: 28px; height: 28px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: 700; }
    .license-table .product-icon.ws { background: var(--accent-blue-bg); color: var(--accent-blue); }
    .license-table .product-icon.sql { background: var(--accent-purple-bg); color: var(--accent-purple); }
    .license-table .product-icon.rds { background: var(--accent-green-bg); color: var(--accent-green); }
    .license-table .value-cell { font-family: 'Space Mono', monospace; font-weight: 600; }
    .license-table .required-cell { font-family: 'Space Mono', monospace; color: var(--accent-orange); font-weight: 600; }
    .alert-box { background: var(--accent-red-bg); border-left: 4px solid var(--accent-red); border-radius: 8px; padding: 1rem; margin-bottom: 1rem; }
    .alert-box.warning { background: var(--accent-yellow-bg); border-left-color: var(--accent-yellow); }
    .alert-title { font-size: 0.85rem; font-weight: 700; color: var(--accent-red); margin-bottom: 0.4rem; }
    .alert-box.warning .alert-title { color: var(--accent-yellow); }
    .alert-content { font-size: 0.85rem; color: var(--text-secondary); line-height: 1.6; }
    .checklist-full { display: grid; gap: 0.6rem; }
    .checklist-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; background: rgba(255,255,255,0.5); border-radius: 8px; }
    .checklist-checkbox { width: 22px; height: 22px; border-radius: 50%; border: 2px solid var(--border-color); display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
    .checklist-checkbox.checked { background: var(--accent-green); border-color: var(--accent-green); }
    .checklist-checkbox.checked::after { content: 'âœ“'; color: white; font-size: 0.75rem; font-weight: bold; }
    .checklist-text { font-size: 0.9rem; color: var(--text-primary); }
    .checklist-text.done { color: var(--text-muted); text-decoration: line-through; }
    .no-data { color: var(--text-muted); font-style: italic; font-size: 0.8rem; }
    
    @media (max-width: 768px) { 
      .app-container { padding: 1rem; } 
      .header { flex-direction: column; gap: 1rem; padding: 1.25rem; } 
      .header-right { flex-direction: column; align-items: flex-start; gap: 0.75rem; width: 100%; }
      .subsidiary-filter { width: 100%; }
      .kpi-grid { grid-template-columns: repeat(2, 1fr); gap: 0.75rem; } 
      .kpi-card { padding: 1rem; }
      .kpi-value { font-size: 1.5rem; }
      .license-section { grid-template-columns: 1fr; gap: 1.5rem; }
      .compliance-bars { gap: 0.75rem; }
      .compliance-bar-item { padding: 0.875rem 1rem; }
      .license-card { padding: 1rem; }
      .license-card-value { font-size: 1.2rem; }
      .license-card-editions { flex-direction: column; gap: 0.5rem; }
      .bu-grid { grid-template-columns: 1fr; } 
      .info-grid { grid-template-columns: 1fr; } 
      .info-item.full-width { grid-column: span 1; }
      .tabs-container { width: 100%; justify-content: center; }
      .tab { padding: 0.5rem 0.8rem; font-size: 0.8rem; }
      .filter-bar { flex-direction: column; }
      .search-input { min-width: 100%; }
      .eos-breakdown { flex-direction: column; gap: 0.5rem; }
    }
    
    @media (max-width: 480px) {
      .kpi-grid { grid-template-columns: 1fr; }
      .kpi-card { padding: 0.875rem; }
      .header h1 { font-size: 1.1rem; }
      .bu-card { padding: 1rem; }
      .bu-name { font-size: 1rem; }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const CONFIG = { GOOGLE_SHEETS: { ENABLED: true, API_KEY: 'AIzaSyD7F4sjl8DUYvfLBOq5N5cXm-AThaDnGdY', SPREADSHEET_ID: '1RldtkHxCkFH9iDVNxEuAW_C1bWSzOlNOv_e5aPjvBFc', SHEET_NAME: 'Data' }, AUTO_REFRESH_MINUTES: 5 };
    const WORKFLOW_STEPS = ["Questionnaire sent", "Questionnaire received", "Initial analysis", "Follow-up sent", "Additional data received", "RVTools received", "SQL scripts received", "Final analysis", "Report delivered"];
    
    // License Entitlements by Subsidiary (from OC_Licences.xlsx)
    const LICENSE_ENTITLEMENTS = {
      "Budenheim": {
        ws_standard: 364,
        ws_datacenter: 30,
        sql_standard: 16,
        sql_enterprise: 16,
        rds_cals: 100,
        hasData: true
      },
      "Martin Braun": {
        ws_standard: 16,
        ws_datacenter: 172,
        sql_standard: 4,
        sql_enterprise: 0,
        rds_cals: 0,
        hasData: true
      },
      "Henkell Freixenet": {
        ws_standard: 968,
        ws_datacenter: 90,
        sql_standard: 14,
        sql_enterprise: 0,
        rds_cals: 50,
        hasData: false // No deployment data yet
      },
      "OE. Hotels": {
        ws_standard: 128,
        ws_datacenter: 0,
        sql_standard: 16,
        sql_enterprise: 0,
        rds_cals: 0,
        hasData: false // No deployment data yet
      }
    };
    
    // License Requirements (deployed) by Subsidiary
    const LICENSE_REQUIREMENTS = {
      "Budenheim": {
        ws_standard: 248,
        ws_datacenter: 128,
        sql_standard: 16,
        sql_enterprise: 16,
        rds_cals: 70,
        ws_deployed: 138,
        sql_deployed: 4,
        rds_deployed: 4
      },
      "Martin Braun": {
        ws_standard: 96,
        ws_datacenter: 292,
        sql_standard: 32,
        sql_enterprise: 34,
        rds_cals: 1099,
        ws_deployed: 196,
        sql_deployed: 27,
        rds_deployed: 9
      },
      "Henkell Freixenet": {
        ws_standard: 0,
        ws_datacenter: 0,
        sql_standard: 0,
        sql_enterprise: 0,
        rds_cals: 0,
        ws_deployed: 0,
        sql_deployed: 0,
        rds_deployed: 0
      },
      "OE. Hotels": {
        ws_standard: 0,
        ws_datacenter: 0,
        sql_standard: 0,
        sql_enterprise: 0,
        rds_cals: 0,
        ws_deployed: 0,
        sql_deployed: 0,
        rds_deployed: 0
      }
    };

    const DEFAULT_DATA = [
      { unit_id: "1", unit_name: "Agrano KG", subsidiary: "Martin Braun", country: "Germany", questionnaire_status: "Complete", response_rate: 90, priority: "Medium", critical_points: "", missing_data: "", infrastructure_summary: "4 ESXi hosts, 8 VMs, vMotion enabled", ws_deployed: 8, ws_licenses_required: "72 cores Std", sql_deployed: "Express", sql_licenses_required: "Free", rds_deployed: "", rds_licenses_required: "", steps: [true,true,true,true,true,true,false,true,false] },
      { unit_id: "2", unit_name: "Diversi Foods", subsidiary: "Martin Braun", country: "Belgium", questionnaire_status: "Complete", response_rate: 90, priority: "Medium", critical_points: "", missing_data: "", infrastructure_summary: "2 ESXi, vMotion enabled", ws_deployed: 6, ws_licenses_required: "32 cores DC", sql_deployed: "Express", sql_licenses_required: "Free", rds_deployed: "", rds_licenses_required: "", steps: [true,true,true,true,true,true,false,true,false] },
      { unit_id: "3", unit_name: "MBI-Zerouno", subsidiary: "Martin Braun", country: "Italy", questionnaire_status: "Complete", response_rate: 95, priority: "Medium", critical_points: "1x WS 2012 R2 EOS", missing_data: "", infrastructure_summary: "2 ESXi hosts, 10 VMs", ws_deployed: 10, ws_licenses_required: "32 cores Std", sql_deployed: "Express", sql_licenses_required: "Free", rds_deployed: "", rds_licenses_required: "", steps: [true,true,true,true,true,true,true,true,false] },
      { unit_id: "4", unit_name: "MBES", subsidiary: "Martin Braun", country: "Spain", questionnaire_status: "Pending", response_rate: 85, priority: "High", critical_points: "OEM + vMotion conflict", missing_data: "License type clarification", infrastructure_summary: "2 Hyper-V hosts, vMotion", ws_deployed: 5, ws_licenses_required: "24 cores Std", sql_deployed: "4x Express", sql_licenses_required: "Free", rds_deployed: 1, rds_licenses_required: "15 CALs", steps: [true,true,true,true,true,false,false,false,false] },
      { unit_id: "5", unit_name: "WBB", subsidiary: "Martin Braun", country: "Germany", questionnaire_status: "Pending", response_rate: 75, priority: "Critical", critical_points: "SQL Enterprise + vMotion/DRS = Datacenter required", missing_data: "RVTools; Host cores; SQL details", infrastructure_summary: "3 ESXi + Proxmox, 88 VMs, DRS enabled", ws_deployed: 61, ws_licenses_required: "TBD (Datacenter)", sql_deployed: "2 Ent + 3 VMs", sql_licenses_required: "Enterprise TBD", rds_deployed: 1, rds_licenses_required: "195 CALs", steps: [true,true,true,true,false,false,false,false,false] },
      { unit_id: "6", unit_name: "Budenheim", subsidiary: "Budenheim", country: "Germany", questionnaire_status: "Complete", response_rate: 95, priority: "High", critical_points: "SQL Enterprise Always On; DRS on Germany cluster", missing_data: "License proofs", infrastructure_summary: "17 ESXi (376 cores), 138 VMs, 7 countries, DRS on DEBUDVMCL1", ws_deployed: 138, ws_licenses_required: "128c DC + 248c Std", sql_deployed: "2 Ent + 2 Std", sql_licenses_required: "16c Ent + 16c Std", rds_deployed: 4, rds_licenses_required: "70 CALs", steps: [true,true,true,true,true,true,true,true,false] },
      { unit_id: "7", unit_name: "Agrano AG", subsidiary: "Martin Braun", country: "Switzerland", questionnaire_status: "Complete", response_rate: 85, priority: "Medium", critical_points: "", missing_data: "", infrastructure_summary: "2 ESXi hosts", ws_deployed: 6, ws_licenses_required: "32 cores Std", sql_deployed: 1, sql_licenses_required: "8 cores Std", rds_deployed: "", rds_licenses_required: "", steps: [true,true,true,true,true,true,false,true,false] },
      { unit_id: "8", unit_name: "Polen Food", subsidiary: "Martin Braun", country: "Turkey", questionnaire_status: "Complete", response_rate: 90, priority: "High", critical_points: "4x EOS VMs (WS2008R2, WS2012); SQL CALs gap", missing_data: "SQL CAL count", infrastructure_summary: "4 ESXi (68 cores), 18 VMs, 3 sites, HA enabled", ws_deployed: 17, ws_licenses_required: "64 cores Std", sql_deployed: "1 Std + 2 Exp", sql_licenses_required: "4c Std + 60-70 CALs", rds_deployed: 2, rds_licenses_required: "54 CALs", steps: [true,true,true,true,true,true,true,true,false] },
      { unit_id: "9", unit_name: "Montana GB", subsidiary: "Martin Braun", country: "United Kingdom", questionnaire_status: "Complete", response_rate: 95, priority: "Critical", critical_points: "âš ï¸ SQL 2019 ENTERPRISE undeclared (10 cores)", missing_data: "SQL Enterprise license verification", infrastructure_summary: "4 ESXi hosts, 13 VMs, 2 sites", ws_deployed: 11, ws_licenses_required: "64 cores Std", sql_deployed: "1 Std + 1 Ent", sql_licenses_required: "8c Std + 10c Ent âš ï¸", rds_deployed: 1, rds_licenses_required: "500 CALs", steps: [true,true,true,true,true,true,true,true,false] },
      { unit_id: "10", unit_name: "MBPL", subsidiary: "Martin Braun", country: "Poland", questionnaire_status: "Complete", response_rate: 95, priority: "Low", critical_points: "", missing_data: "SQL license proof", infrastructure_summary: "2 Hyper-V hosts (20 cores), 6 VMs, no HA", ws_deployed: 5, ws_licenses_required: "32 cores Std", sql_deployed: "1 Std", sql_licenses_required: "4 cores Std", rds_deployed: "", rds_licenses_required: "", steps: [true,true,true,true,true,true,true,true,false] },
      { unit_id: "11", unit_name: "MBN", subsidiary: "Martin Braun", country: "Netherlands", questionnaire_status: "Pending", response_rate: 70, priority: "Medium", critical_points: "", missing_data: "Windows/SQL editions", infrastructure_summary: "1 physical + VMs", ws_deployed: 4, ws_licenses_required: "8 cores Std", sql_deployed: "TBD", sql_licenses_required: "TBD", rds_deployed: "", rds_licenses_required: "", steps: [true,true,true,true,false,false,false,false,false] },
      { unit_id: "12", unit_name: "MBR", subsidiary: "Martin Braun", country: "-", questionnaire_status: "Out of Scope", response_rate: 0, priority: "", critical_points: "", missing_data: "", infrastructure_summary: "", ws_deployed: "", ws_licenses_required: "", sql_deployed: "", sql_licenses_required: "", rds_deployed: "", rds_licenses_required: "", steps: [false,false,false,false,false,false,false,false,false] },
      { unit_id: "13", unit_name: "MBHU", subsidiary: "Martin Braun", country: "Hungary", questionnaire_status: "Pending", response_rate: 40, priority: "High", critical_points: "", missing_data: "Infrastructure details needed", infrastructure_summary: "TBD", ws_deployed: "", ws_licenses_required: "TBD", sql_deployed: "", sql_licenses_required: "TBD", rds_deployed: "", rds_licenses_required: "", steps: [true,true,false,true,false,false,false,false,false] },
      { unit_id: "14", unit_name: "BE (Dakri)", subsidiary: "Martin Braun", country: "Poland", questionnaire_status: "Complete", response_rate: 90, priority: "Medium", critical_points: "", missing_data: "", infrastructure_summary: "4 ESXi hosts, DRS enabled", ws_deployed: 12, ws_licenses_required: "64 cores DC", sql_deployed: 1, sql_licenses_required: "8 cores Std", rds_deployed: 1, rds_licenses_required: "10 CALs", steps: [true,true,true,true,true,true,true,true,false] },
      { unit_id: "15", unit_name: "Hoffs America", subsidiary: "Martin Braun", country: "USA", questionnaire_status: "Complete", response_rate: 90, priority: "Medium", critical_points: "", missing_data: "", infrastructure_summary: "1 physical server", ws_deployed: 3, ws_licenses_required: "16 cores Std", sql_deployed: "Express", sql_licenses_required: "Free", rds_deployed: 1, rds_licenses_required: "25 CALs", steps: [true,true,true,true,true,true,false,true,false] },
      { unit_id: "16", unit_name: "CAP Fruit", subsidiary: "Martin Braun", country: "France", questionnaire_status: "Complete", response_rate: 85, priority: "Medium", critical_points: "", missing_data: "", infrastructure_summary: "2 ESXi hosts", ws_deployed: 8, ws_licenses_required: "32 cores Std", sql_deployed: "Express", sql_licenses_required: "Free", rds_deployed: "", rds_licenses_required: "", steps: [true,true,true,true,true,true,false,true,false] },
      { unit_id: "17", unit_name: "AU & DE", subsidiary: "Martin Braun", country: "Germany", questionnaire_status: "Complete", response_rate: 90, priority: "High", critical_points: "DRS enabled = Datacenter required; 9x WS 2012 EOS", missing_data: "", infrastructure_summary: "10 ESXi hosts (160 cores), 2 clusters with DRS", ws_deployed: 45, ws_licenses_required: "160 cores DC", sql_deployed: "Enterprise", sql_licenses_required: "Enterprise", rds_deployed: 3, rds_licenses_required: "300 CALs", steps: [true,true,true,true,true,true,true,true,false] },
    ];

    // Compliance Bar Component
    function ComplianceBar({ label, metric, required, entitled, icon }) {
      const percentage = entitled > 0 ? Math.round((required / entitled) * 100) : (required > 0 ? 999 : 0);
      const isCompliant = percentage <= 100;
      const isWarning = percentage > 80 && percentage <= 100;
      const isOver = percentage > 100;
      const gap = entitled - required;
      const fillWidth = Math.min(isOver ? 100 : percentage, 100);
      
      let statusClass = 'compliant';
      if (isOver) statusClass = 'over';
      else if (isWarning) statusClass = 'warning';
      
      return (
        <div className="compliance-bar-item">
          <div className="compliance-bar-header">
            <div className="compliance-bar-label">
              <span>{icon}</span>
              <span>{label}</span>
              <span className="compliance-bar-metric">{metric}</span>
            </div>
            <div className="compliance-bar-values">
              <span className="required">{required.toLocaleString()}</span>
              <span className="entitled"> / {entitled.toLocaleString()}</span>
            </div>
          </div>
          <div className="compliance-bar-container">
            <div 
              className={`compliance-bar-fill ${statusClass}`}
              style={{ width: `${fillWidth}%` }}
            />
            {entitled > 0 && <div className="compliance-bar-marker" style={{ left: `${Math.min(100, (entitled / Math.max(required, entitled)) * 100)}%` }}></div>}
          </div>
          <div className="compliance-bar-footer">
            <span className={`compliance-percentage ${statusClass}`}>
              {percentage > 999 ? 'âˆž' : `${percentage}%`} {isCompliant ? 'âœ“' : 'âš '}
            </span>
            <span className={`compliance-gap ${gap >= 0 ? 'surplus' : 'deficit'}`}>
              {gap >= 0 ? `+${gap.toLocaleString()}` : `${gap.toLocaleString()}`} {metric.toLowerCase().includes('cal') ? 'CALs' : 'cores'}
            </span>
          </div>
        </div>
      );
    }

    async function fetchGoogleSheetsData() {
      const { API_KEY, SPREADSHEET_ID, SHEET_NAME } = CONFIG.GOOGLE_SHEETS;
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${SHEET_NAME}?key=${API_KEY}`;
      const response = await fetch(url);
      if (!response.ok) throw new Error('Failed to fetch');
      const data = await response.json();
      const rows = data.values;
      if (!rows || rows.length < 2) return [];
      const headers = rows[0];
      return rows.slice(1).map(row => {
        const obj = {};
        headers.forEach((h, i) => {
          const key = h.toLowerCase().replace(/\s+/g, '_');
          let val = row[i] || '';
          if (['response_rate','ws_deployed','sql_deployed','rds_deployed'].includes(key)) val = val === '' ? '' : parseInt(val) || 0;
          if (key === 'steps') val = val.split(',').map(v => v.trim().toLowerCase() === 'true');
          obj[key] = val;
        });
        if (!obj.steps || !Array.isArray(obj.steps)) obj.steps = Array(9).fill(false);
        if (!obj.subsidiary) obj.subsidiary = 'Martin Braun';
        return obj;
      });
    }

    function App() {
      const [data, setData] = React.useState(DEFAULT_DATA);
      const [loading, setLoading] = React.useState(false);
      const [lastUpdate, setLastUpdate] = React.useState(new Date());
      const [activeTab, setActiveTab] = React.useState("all");
      const [searchTerm, setSearchTerm] = React.useState("");
      const [selectedBU, setSelectedBU] = React.useState(null);
      const [subsidiaryFilter, setSubsidiaryFilter] = React.useState("all");
      const [showEOS, setShowEOS] = React.useState(false);

      React.useEffect(() => {
        if (!CONFIG.GOOGLE_SHEETS.ENABLED) return;
        const load = async () => {
          setLoading(true);
          try { const d = await fetchGoogleSheetsData(); if (d.length) setData(d); setLastUpdate(new Date()); } catch(e) { console.error(e); }
          setLoading(false);
        };
        load();
        if (CONFIG.AUTO_REFRESH_MINUTES > 0) { const i = setInterval(load, CONFIG.AUTO_REFRESH_MINUTES * 60000); return () => clearInterval(i); }
      }, []);

      // Get subsidiaries with data status
      const subsidiaries = ["Martin Braun", "Budenheim", "Henkell Freixenet", "OE. Hotels"];
      
      const subsidiaryFiltered = subsidiaryFilter === "all" 
        ? data 
        : data.filter(bu => bu.subsidiary === subsidiaryFilter);

      const filtered = subsidiaryFiltered.filter(bu => {
        const match = bu.unit_name.toLowerCase().includes(searchTerm.toLowerCase()) || 
                      bu.country.toLowerCase().includes(searchTerm.toLowerCase()) || 
                      bu.unit_id.toLowerCase().includes(searchTerm.toLowerCase());
        if (activeTab === "all") return match;
        if (activeTab === "high") return match && (bu.priority === "High" || bu.priority === "Critical");
        if (activeTab === "pending") return match && (bu.questionnaire_status === "Pending" || bu.response_rate < 70);
        if (activeTab === "complete") return match && bu.questionnaire_status === "Complete";
        return match;
      });

      // Calculate aggregated license data based on filter
      const getAggregatedLicenses = () => {
        if (subsidiaryFilter === "all") {
          // Sum all subsidiaries
          const entitled = {
            ws_standard: Object.values(LICENSE_ENTITLEMENTS).reduce((sum, s) => sum + s.ws_standard, 0),
            ws_datacenter: Object.values(LICENSE_ENTITLEMENTS).reduce((sum, s) => sum + s.ws_datacenter, 0),
            sql_standard: Object.values(LICENSE_ENTITLEMENTS).reduce((sum, s) => sum + s.sql_standard, 0),
            sql_enterprise: Object.values(LICENSE_ENTITLEMENTS).reduce((sum, s) => sum + s.sql_enterprise, 0),
            rds_cals: Object.values(LICENSE_ENTITLEMENTS).reduce((sum, s) => sum + s.rds_cals, 0),
          };
          const required = {
            ws_standard: Object.values(LICENSE_REQUIREMENTS).reduce((sum, s) => sum + s.ws_standard, 0),
            ws_datacenter: Object.values(LICENSE_REQUIREMENTS).reduce((sum, s) => sum + s.ws_datacenter, 0),
            sql_standard: Object.values(LICENSE_REQUIREMENTS).reduce((sum, s) => sum + s.sql_standard, 0),
            sql_enterprise: Object.values(LICENSE_REQUIREMENTS).reduce((sum, s) => sum + s.sql_enterprise, 0),
            rds_cals: Object.values(LICENSE_REQUIREMENTS).reduce((sum, s) => sum + s.rds_cals, 0),
            ws_deployed: Object.values(LICENSE_REQUIREMENTS).reduce((sum, s) => sum + s.ws_deployed, 0),
            sql_deployed: Object.values(LICENSE_REQUIREMENTS).reduce((sum, s) => sum + s.sql_deployed, 0),
            rds_deployed: Object.values(LICENSE_REQUIREMENTS).reduce((sum, s) => sum + s.rds_deployed, 0),
          };
          const hasData = Object.values(LICENSE_ENTITLEMENTS).some(s => s.hasData);
          return { entitled, required, hasData };
        } else {
          const entitled = LICENSE_ENTITLEMENTS[subsidiaryFilter] || {};
          const required = LICENSE_REQUIREMENTS[subsidiaryFilter] || {};
          const hasData = entitled.hasData || false;
          return { entitled, required, hasData };
        }
      };

      const { entitled, required, hasData } = getAggregatedLicenses();

      const activeData = subsidiaryFiltered.filter(b => b.questionnaire_status !== "Out of Scope");
      const kpis = { 
        total: activeData.length, 
        complete: activeData.filter(b => b.questionnaire_status === "Complete").length,
        avg: activeData.length > 0 ? Math.round(activeData.reduce((a,b) => a + (b.response_rate||0), 0) / activeData.length) : 0, 
        critical: activeData.filter(b => b.priority === "Critical" || b.priority === "High").length, 
        pending: activeData.filter(b => b.questionnaire_status === "Pending").length
      };

      const statusClass = s => {
        if (s === "Complete") return "complete";
        if (s === "Received") return "received";
        if (s === "Pending") return "pending";
        if (s === "Incomplete") return "incomplete";
        if (s === "Out of Scope") return "out-of-scope";
        if (s === "No Data") return "no-data";
        return "not-sent";
      };

      const subsidiaryClass = s => {
        if (s === "Budenheim") return "budenheim";
        if (s === "Martin Braun") return "martin-braun";
        if (s === "Henkell Freixenet") return "henkell-freixenet";
        if (s === "OE. Hotels") return "oe-hotels";
        return "martin-braun";
      };

      const hasLicense = bu => bu.ws_deployed !== '' || bu.sql_deployed !== '' || bu.rds_deployed !== '';

      return (
        <div className="app-container">
          <div className="header-wrapper">
            <header className="header">
              <div className="logo-section">
                <svg className="logo-img" viewBox="0 0 200 50"><circle cx="12" cy="12" r="5" fill="#E87A2A"/><circle cx="22" cy="8" r="8" fill="#E87A2A"/><circle cx="12" cy="28" r="8" fill="#E87A2A"/><circle cx="22" cy="38" r="5" fill="#E87A2A"/><circle cx="8" cy="40" r="4" fill="#E87A2A"/><text x="38" y="32" fontFamily="DM Sans" fontSize="24" fontWeight="700" fill="white">appstrato</text></svg>
                <div className="logo-text"><h1>Microsoft Licensing Tracker</h1><span>Oetker Collection</span></div>
              </div>
              <div className="header-right">
                <div className="subsidiary-filter">
                  <label>Subsidiary:</label>
                  <select value={subsidiaryFilter} onChange={e => setSubsidiaryFilter(e.target.value)}>
                    <option value="all">All Subsidiaries</option>
                    {subsidiaries.map(s => (
                      <option key={s} value={s}>{s} {!LICENSE_ENTITLEMENTS[s]?.hasData ? '(No data)' : ''}</option>
                    ))}
                  </select>
                </div>
                <div>
                  <div className="last-update">Updated: {lastUpdate.toLocaleString()}</div>
                  {loading && <div className="loading-indicator"><div className="loading-dot"></div> Syncing...</div>}
                </div>
              </div>
            </header>
          </div>

          {/* KPI Grid - 5 cards */}
          <div className="kpi-grid">
            <div className="kpi-card"><div className="kpi-label">Total BUs</div><div className="kpi-value">{kpis.total}</div></div>
            <div className="kpi-card green"><div className="kpi-label">Complete</div><div className="kpi-value">{kpis.complete}</div><div className="kpi-subtitle">{kpis.total > 0 ? Math.round(kpis.complete/kpis.total*100) : 0}%</div></div>
            <div className="kpi-card"><div className="kpi-label">Avg Response</div><div className="kpi-value">{kpis.avg}%</div></div>
            <div className="kpi-card red"><div className="kpi-label">Critical/High</div><div className="kpi-value">{kpis.critical}</div></div>
            <div className="kpi-card yellow"><div className="kpi-label">Pending</div><div className="kpi-value">{kpis.pending}</div></div>
          </div>

          {/* Main License Section */}
          <div className="license-section">
            {/* Compliance Bars */}
            <div className="compliance-panel">
              <div className="section-header">
                <span className="section-title">License Compliance</span>
              </div>
              
              {hasData ? (
                <div className="compliance-bars">
                  <ComplianceBar 
                    label="Windows Server Datacenter" 
                    metric="Cores" 
                    required={required.ws_datacenter || 0} 
                    entitled={entitled.ws_datacenter || 0}
                    icon="ðŸ–¥ï¸"
                  />
                  <ComplianceBar 
                    label="Windows Server Standard" 
                    metric="Cores" 
                    required={required.ws_standard || 0} 
                    entitled={entitled.ws_standard || 0}
                    icon="ðŸ–¥ï¸"
                  />
                  <ComplianceBar 
                    label="SQL Server Enterprise" 
                    metric="Cores" 
                    required={required.sql_enterprise || 0} 
                    entitled={entitled.sql_enterprise || 0}
                    icon="ðŸ—„ï¸"
                  />
                  <ComplianceBar 
                    label="SQL Server Standard" 
                    metric="Cores" 
                    required={required.sql_standard || 0} 
                    entitled={entitled.sql_standard || 0}
                    icon="ðŸ—„ï¸"
                  />
                  <ComplianceBar 
                    label="RDS User CALs" 
                    metric="User CALs" 
                    required={required.rds_cals || 0} 
                    entitled={entitled.rds_cals || 0}
                    icon="ðŸ‘¥"
                  />
                </div>
              ) : (
                <div className="no-data-state">
                  <div className="no-data-icon">ðŸ“Š</div>
                  <div className="no-data-text">No deployment data available</div>
                  <div className="no-data-subtext">Analysis pending for {subsidiaryFilter}</div>
                </div>
              )}
            </div>
          </div>

          <div style={{fontSize:'0.7rem',color:'rgba(255,255,255,0.4)',marginTop:'-0.5rem',marginBottom:'2rem'}}>* Some BUs have pending data (TBD) - totals may increase</div>

          {/* Data Collection Section */}
          <div className="section-header">
            <span className="section-title">Data Collection & Analysis</span>
          </div>

          <div className="tabs-container">
            {[{id:"all",label:"All"},{id:"high",label:"Critical/High"},{id:"pending",label:"Pending"},{id:"complete",label:"Complete"}].map(t => <button key={t.id} className={`tab ${activeTab===t.id?'active':''}`} onClick={() => setActiveTab(t.id)}>{t.label}</button>)}
          </div>

          <div className="filter-bar">
            <input className="search-input" placeholder="ðŸ” Search by name, country, or ID..." value={searchTerm} onChange={e => setSearchTerm(e.target.value)} />
            <div className="eos-badge" onClick={() => setShowEOS(true)}>
              <span className="eos-badge-icon">âš ï¸</span>
              <span className="eos-badge-text">End of Support</span>
              <span className="eos-badge-count">14</span>
            </div>
          </div>

          <div className="bu-grid">
            {filtered.map(bu => (
              <div key={bu.unit_id} className="bu-card" onClick={() => setSelectedBU(bu)}>
                {bu.priority && bu.priority !== '' && <span className={`priority-badge ${bu.priority.toLowerCase()}`}>{bu.priority}</span>}
                <div className="bu-card-header">
                  <div>
                    <span className="bu-unit-badge">Unit {bu.unit_id}</span>
                    <div className="bu-name">{bu.unit_name}</div>
                    <div className="bu-country">ðŸ“ {bu.country}</div>
                    <div className="bu-subsidiary">
                      <span className={`subsidiary-tag ${subsidiaryClass(bu.subsidiary)}`}>{bu.subsidiary}</span>
                    </div>
                  </div>
                  <span className={`status-badge ${statusClass(bu.questionnaire_status)}`}><span className="status-dot"></span>{bu.questionnaire_status}</span>
                </div>
                {bu.infrastructure_summary && <div className="bu-infra-summary">ðŸ—ï¸ {bu.infrastructure_summary}</div>}
                <div className="progress-section"><div className="progress-header"><span className="progress-label">Response Rate</span><span className="progress-value">{bu.response_rate}%</span></div><div className="progress-bar"><div className="progress-fill" style={{width:`${bu.response_rate}%`}}></div></div></div>
                <div className="license-summary">
                  {bu.ws_deployed !== '' && <span className="license-tag ws">ðŸ–¥ï¸ WS: {bu.ws_deployed}</span>}
                  {bu.sql_deployed !== '' && <span className="license-tag sql">ðŸ—„ï¸ SQL: {bu.sql_deployed}</span>}
                  {bu.rds_deployed !== '' && <span className="license-tag rds">ðŸ‘¥ RDS: {bu.rds_deployed}</span>}
                  {!hasLicense(bu) && <span className="no-data">No license data yet</span>}
                </div>
                <div className="checklist-mini">{(bu.steps||[]).map((d,i) => <div key={i} className={`check-dot ${d?'done':''}`}></div>)}</div>
              </div>
            ))}
          </div>

          {selectedBU && (
            <div className="modal-overlay" onClick={() => setSelectedBU(null)}>
              <div className="modal-content" onClick={e => e.stopPropagation()}>
                <div className="modal-header">
                  <div>
                    <span className="bu-unit-badge">Unit {selectedBU.unit_id}</span>
                    <h2 style={{fontSize:'1.5rem',marginTop:'0.5rem',color:'var(--text-primary)'}}>{selectedBU.unit_name}</h2>
                    <div className="bu-country">ðŸ“ {selectedBU.country}</div>
                    <div style={{marginTop:'0.5rem'}}><span className={`subsidiary-tag ${subsidiaryClass(selectedBU.subsidiary)}`}>{selectedBU.subsidiary}</span></div>
                  </div>
                  <button className="modal-close" onClick={() => setSelectedBU(null)}>Ã—</button>
                </div>
                <div className="modal-body">
                  <div className="detail-section"><h3>Status</h3>
                    <div className="info-grid">
                      <div className="info-item"><div className="info-label">Status</div><div className="info-value">{selectedBU.questionnaire_status}</div></div>
                      <div className="info-item"><div className="info-label">Response</div><div className="info-value">{selectedBU.response_rate}%</div></div>
                      <div className="info-item"><div className="info-label">Priority</div><div className="info-value">{selectedBU.priority || 'â€”'}</div></div>
                      <div className="info-item"><div className="info-label">Country</div><div className="info-value">{selectedBU.country}</div></div>
                      {selectedBU.infrastructure_summary && <div className="info-item full-width"><div className="info-label">Infrastructure Summary</div><div className="info-value infra">ðŸ—ï¸ {selectedBU.infrastructure_summary}</div></div>}
                    </div>
                  </div>
                  <div className="detail-section"><h3>License Requirements</h3><table className="license-table"><thead><tr><th>Product</th><th>Deployed</th><th>Required</th></tr></thead><tbody><tr><td><div className="product-cell"><span className="product-icon ws">WS</span>Windows Server</div></td><td className="value-cell">{selectedBU.ws_deployed!==''?selectedBU.ws_deployed:'â€”'}</td><td className="required-cell">{selectedBU.ws_licenses_required||'â€”'}</td></tr><tr><td><div className="product-cell"><span className="product-icon sql">SQL</span>SQL Server</div></td><td className="value-cell">{selectedBU.sql_deployed!==''?selectedBU.sql_deployed:'â€”'}</td><td className="required-cell">{selectedBU.sql_licenses_required||'â€”'}</td></tr><tr><td><div className="product-cell"><span className="product-icon rds">RDS</span>Remote Desktop</div></td><td className="value-cell">{selectedBU.rds_deployed!==''?selectedBU.rds_deployed:'â€”'}</td><td className="required-cell">{selectedBU.rds_licenses_required||'â€”'}</td></tr></tbody></table></div>
                  {selectedBU.critical_points && <div className="detail-section"><h3>Critical Points</h3><div className="alert-box"><div className="alert-title">âš ï¸ Attention</div><div className="alert-content">{selectedBU.critical_points}</div></div></div>}
                  {selectedBU.missing_data && <div className="detail-section"><h3>Missing Data</h3><div className="alert-box warning"><div className="alert-title">ðŸ“‹ Requested</div><div className="alert-content">{selectedBU.missing_data}</div></div></div>}
                  <div className="detail-section"><h3>Workflow</h3><div className="checklist-full">{WORKFLOW_STEPS.map((s,i) => <div key={i} className="checklist-item"><div className={`checklist-checkbox ${(selectedBU.steps||[])[i]?'checked':''}`}></div><span className={`checklist-text ${(selectedBU.steps||[])[i]?'done':''}`}>{s}</span></div>)}</div></div>
                </div>
              </div>
            </div>
          )}

          {/* EOS Modal */}
          {showEOS && (
            <div className="modal-overlay" onClick={() => setShowEOS(false)}>
              <div className="eos-modal" onClick={e => e.stopPropagation()}>
                <div className="eos-modal-header">
                  <div className="eos-modal-title">
                    <span>âš ï¸</span>
                    <span>End of Support Systems</span>
                  </div>
                  <button className="eos-modal-close" onClick={() => setShowEOS(false)}>Ã—</button>
                </div>
                <div className="eos-modal-value">14</div>
                <div className="eos-modal-label">VMs running unsupported Windows versions</div>
                <div className="eos-modal-breakdown">
                  <div className="eos-modal-item">
                    <div className="eos-modal-item-left">
                      <div className="eos-modal-dot critical"></div>
                      <span className="eos-modal-item-label">Windows Server 2008 R2</span>
                    </div>
                    <span className="eos-modal-item-count">2</span>
                  </div>
                  <div className="eos-modal-item">
                    <div className="eos-modal-item-left">
                      <div className="eos-modal-dot high"></div>
                      <span className="eos-modal-item-label">Windows Server 2012</span>
                    </div>
                    <span className="eos-modal-item-count">3</span>
                  </div>
                  <div className="eos-modal-item">
                    <div className="eos-modal-item-left">
                      <div className="eos-modal-dot medium"></div>
                      <span className="eos-modal-item-label">Windows Server 2012 R2</span>
                    </div>
                    <span className="eos-modal-item-count">9</span>
                  </div>
                </div>
                <div className="eos-modal-affected">
                  <strong>Affected BUs:</strong> MBI-Zerouno, Polen Food, AU & DE
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }
    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
